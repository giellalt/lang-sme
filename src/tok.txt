# =============================================================
# CONTENT: Sample Finite-State Tokenizer (no multi-words)
# AUTHOR: Original version by Anne Schiller, copied from the
# Karttunen/Beesley book on finite state grammar
# Modified by Trond Trosterud, 2002.
# CREATED: 12-Jun-1997
# UPDATED: 05-Sep-2001
# =============================================================
# Usage: xfst -f [ThisFile]
# =============================================================

clear stack
echo >>> define white space
define SP " ";
define TAB "\t";
define NL "\n";

define WS [SP|NL|TAB];

# =============================================================
echo >>> define single character symbols
define SINGLE [ %" | %. | %, | %; | %: | %! | %?
| %( | %) | %[ | %] | %{ | %} | %/ | %% 
];
# Added the string ' | %/' above, for ja/dahje cases.
define PUNCT [ %. %. (%.) | %' %' | %' %' | %, %, ] ;
define Char \[ WS | SINGLE ] ;

# =============================================================
echo >>> define SYMBOL
#define SYMBOL [ SINGLE | PUNCT ] ;
define SYMBOL [ SINGLE | PUNCT | EXTRAPERIOD ] ;

echo >>> define WORD
define WORD [ Char ]+ ;

# =============================================================
echo >>> regular abbreviations

define Capital [
C1|D1|N1|S1|T1|Z1|
A|B|C|D|E|F|G|H|I|J|K|L|M|N|O|P|Q|R|S|T|U|V|W|X|Y|Z|
Å|Ä|Ö|Ø|Æ|Á|É|Ó|Ú|Í|À|È|Ò|Ù|Ì|Ë|Ü|Ï|Â|Ê|Ô|Û|Î|Ã|Ý|þ|Ñ|Ð ] ;

define Small [ c1|d1|n1|s1|t1|z1|
a|b|c|d|e|f|g|h|i|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z|
å|ä|ö|ø|æ|á|é|ó|ú|í|à|è|ò|ù|ì|ë|ü|ï|â|ê|ô|û|î|ã|ý|þ|ñ|ð|ç|ß];

# =============================================================
echo >>> numeric expressions
define Digit [ %0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9];
define NumOp [ %- | %+ | %* | %/ | %= | %: ];
define NumSep [ %. | %, ];
define NUM [ Digit | NumOp | NumSep]+ & $[Digit] ;

# =============================================================
define Letter [ Small | Capital ] ;
#define INIT [ Capital %. ]+ ;
define INIT [ Letter %. ]+ ; # Thus, INIT not only for T. Trosterud, 
                             # but also for t. Trosterud and s. 43.
define CAPNUM [ Capital | NUM ] ;

# =============================================================
echo >>> list of abbreviations

# There are four groups of abbreviations:
# INTRANSABBR - may end a sentence.

# dot_abbr.db
# <+c,+n>
# Abbreviations that end a sentence if 
# followed by letter in upper case
# or a number.

define INTRANSABBR [
{Kr.f.} |
{Eftf.} |
{ltd.} | 
{Ltd.} | 
{inc.} | 
{Inc.} |
{A.L.} | 
{A.S.} | 
{O.S.} | 
{Fr.P.} | 
{Fr.% P.} | 
{Fr.% p.} | 
{Fr.p.} | 
{K.S.} | 
{Kbh.} | 
{Kr.F.} | 
{Kr.% F.} | 
{Kr.% f.} | 
{Kr.f.} | 
{Krf.} | 
{N.A.F.} | 
{NB.} | 
{FUOM.} | 
{Fuom.} | 
{fuom.} | 
{Nkr.} | 
{Sth.} | 
{adj.} | 
{adm.} | 
{háldd.} | 
{adv.} | 
{arkeol.} | 
{avd.} | 
{oss.} | 
{bakt.} | 
{bm.} | 
{bot.} | 
{d.% e.} | 
{d.% y.} | 
{d.e.} | 
{d.y.} | 
{disp.} | 
{do.} | 
{dy.} | 
{e.Kr.} | 
{m.Kr.} | 
{e.% Kr.} | 
{eg.} | 
{eng.} | 
{est.} | 
{etc.} | 
{jnv.} | 
{jna.} | 
{ev.luth.} | 
{f.Kr.} | 
{o.Kr.} | 
{fem.} | 
{fi.} | 
{fil.} | 
{fl.} | 
{fon.} | 
{c1ál.} | 
{fut.} | 
{gen.} | 
{gram.} | 
{hell.} | 
{hist.} | 
{hoh.} | 
{holl.} | 
{id.} | 
{imp.} | 
{imperat.} | 
{imperf.} | 
{iness.} | 
{inf.} | 
{innb.} | 
{instr.} | 
{int.} | 
{interj.} | 
{intr.} | 
{intrans.} | 
{inv.} | 
{jr.} | 
{kgl.% res.} | 
{kgl.res.} | 
{kjem.} | 
{kem.} |
{km.} | 
{lat.} | 
{lg.} | 
{lim.} | 
{ln.} | 
{lst.} | 
{lstr.} | 
{lávv.} | 
{vuoss.} |
{mán.} |
{mánn.} |
{dis.} |
{gask.} |
{gas.} |
{duo.} |
{duor.} |
{bea.} |
{bearj.} |
{bear.} |
{láv.} |
{sotn.} |
{ma.} | 
{mat.} | 
{med.} | 
{medl.} | 
{miel.} |
{mil.} | 
{min.} | 
{mod.} | 
{mus.} | 
{ndf.} | 
{ned.} | 
{nl.} | 
{nn.} | 
{nord.} | 
{ea.ea} | 
{e.e} | 
{ee.} |
{on.} | 
{p.s.} | 
{pass.} | 
{pluskv.} | 
{pol.} | 
{port.} | 
{ppm.} | 
{pres.} | 
{pret.} | 
{pst.} | 
{q.% e.% d.} | 
{q.% s.} | 
{q.e.d.} | 
{refl.} | 
{reg.} | 
{repr.} | 
{rom.} | 
{ru.} | 
{s.% å.} | 
{s.å.} | 
{sek.} | 
{sen.} | 
{sg.} | 
{sing.} |
{sk.} | 
{ss.} | 
{strl.} | 
{sø.} | 
{ti.} | 
{to.} | 
{tv.} | 
{tyrk.} | 
{nuor.} |
{ung.} | 
{v.v.} | 
{vgs.} |
{joatkkask.} ] ;


# upp% noStb.db
# <-c,+n>
# Abbreviations that are only CLB 
# if followed by a number.
# Mainly titles.

define INTRANSNUMABBR [
{1.aman.} | 
{Bj.} | 
{Chr.} | 
{Dep.} | 
{Edv.} | 
{H.K.H.} | 
{H.M.} | 
{Johs.} | 
{Kr.} | 
{Mlle.} | 
{Mme.} | 
{Mr.} | 
{Mrs.} | 
{Seb.} | 
{agric.} | 
{aman.} | 
{ass.} | 
{avd.dir.} | 
{avs.} | 
{bet.} | 
{cand.} | 
{cand.mag.} | 
{cand.oecon.} | 
{cand.philol.} | 
{cand.real.} | 
{cand.scient.} | 
{cand.theol.} | 
{dipl.ing.} | 
{dipl.ins.} | 
{dir.} | 
{dr.} | 
{dr.art.} | 
{dr.med.} | 
{dr.philos.} | 
{dr.theol.} | 
{eksp.sj.} | 
{eksp.hoavd.} |
{fenr.} | 
{frk.} | 
{gen.lt.} | 
{genr.} | 
{genr.lt.} | 
{h.r.adv.} | 
{hr.} | 
{kapt.} | 
{korp.} | 
{korpr.} | 
{lekt.} | 
{lic.} | 
{ltn.} | 
{mag.} | 
{mag.art.} | 
{merc.} | 
{mr.} | 
{mrs.} | 
{ms.} | 
{obl.} | 
{oblt.} | 
{odont.} | 
{oecon.} | 
{ordf.} | 
{overs.} | 
{pharm.} | 
{philol.} | 
{polit.} | 
{prof.} | 
{psychol.} | 
{psyk.} | 
{res.kap.} | 
{scient.} | 
{sekr.} | 
{sgt.} | 
{siv.ark.} | 
{sjt.} | 
{stud.} | 
{stud.phil.} | 
{stud.polit.} | 
{stud.psych.} | 
{stud.real.} | 
{stud.scient.} | 
{stud.theol.} | 
{sykepl.} | 
{u.dir.} | 
{varaordf.} | 
{vit.ass.} ] ;



# dot% num% noStb.db
# <+c,-n>
# Abbreviations that only end a sentence
# if followed by an upper case letter,
# not when followed by a number.


define INTRANSCAPABBR [
{1.Sam.} | 
{2.Sam.} | 
{Akersgt.} | 
{Elvegt.} |
{B.innst.S.nr.} | 
{Besl.L.nr.} | 
{Besl.O.nr.} | 
{Co.} | 
{Dan.} | 
{Dok.nr.} | 
{Dronningensgt.} | 
{Eidsvollsgt.} | 
{Elvegt.} | 
{Hausmannsgt.} | 
{Holmegt.} | 
{Industrigt.} | 
{Innst.O.nr.} | 
{Innst.S.nr.} | 
{Johansgt.} | 
{Josv.} | 
{Kirkegt.} | 
{Kong.} | 
{Kongensgt.} | 
{Langgt.} | 
{Mark.} | 
{Matt.} | 
{Mos.} | 
{Musegt.} | 
{Ob.} | 
{Olavsgt.} | 
{Oslov.} | 
{Ot.prp.nr.} | 
{Paul.} | 
{Prinsensgt.} | 
{Rom.} | 
{Rådhusgt.} | 
{Sam.} | 
{Slottsgt.} | 
{St.meld.nr.} | 
{St.prp.nr.} | 
{Storgt.} | 
{Strandgt.} | 
{Trondheimsv.} | 
{a.D.} | 
{a.% D.} | 
{apr.} | 
{aug.} | 
{d.} | 
{da.} | 
{des.} | 
{feb.} | 
{gnr.} | 
{it.} | 
{jan.} | 
{jnr.} | 
{jul.} | 
{jun.} | 
{kr.} | 
{litt.omsetn.} | 
{lnr.} | 
{ltd.} | 
{ltr.} | 
{maks.} | 
{mar.} | 
{mask.} | 
{mobiltlf.} | 
{no.} | 
{nov.} | 
{nr.} | 
{okt.} | 
{p.b.} | 
{pb.} | 
{pgf.} | 
{rv.} | 
{sept.} | 
{tlf.} | 
{od1d1j.} |
{guov.} |
{njuk.} |
{cuon1.} |
{mies.} |
{geas.} |
{suoi.} |
{borg.} |
{c1akc1.} |
{golg.} |
{skáb.} |
{juov.} ] ;


# dot% noStb.db
# <-c,-n>
# Abbreviations that never end a sentence, also if followed
# by a capital letter or a number.

define TRANSABBR [
{Mr.} |
{Dom.} |
{Esek.} | 
{I.N.D.} | 
{I.% N.% D.} | 
{IL.} | 
{Jer.} | 
{Joh.} | 
{Lim.} | 
{Lt.} | 
{Neh.} | 
{Ot.} | 
{Ot.% prp.} | 
{Ot.prp.} | 
{Pf.} | 
{Pfg.} | 
{St.} | 
{St.% meld.} | 
{St.% prp.} | 
{St.meld.} | 
{Su.} | 
{Sv.} | 
{Tel.} | 
{Tlf.} | 
{Tlf.nr.} | 
{Univ.} | 
{adr.} | 
{afr.} | 
{akk.} | 
{alb.} | 
{alm.} | 
{am.} | 
{amer.} | 
{arab.} | 
{art.} | 
{atomnr.} | 
{att.} | 
{austr.} | 
{aut.} | 
{balt.} | 
{bet.} | 
{bfr.} | 
{bib.} | 
{biol.} | 
{bnr.} | 
{brig.} | 
{brit.} | 
{brit.-am.} | 
{brit.-austr.} | 
{bto.} | 
{ca.} | 
{cf.} | 
{co.} | 
{d.% c.} | 
{d.% d.} | 
{d.% m.} | 
{d.c.} | 
{d.d.} | 
{d.m.} | 
{d.s.} | 
{dat.} | 
{dept.} | 
{dim.} | 
{div.} | 
{dkr.} | 
{ds.} | 
{eftf.} | 
{eks.} | 
{ekskl.} | 
{et.} | 
{eur.} | 
{ev.} | 
{evt.} | 
{fec.} | 
{fig.} | 
{fol.} | 
{fr.} | 
{geom.} | 
{gr.} | 
{hebr.} | 
{i.% e.} | 
{i.e.} | 
{ib.} | 
{ibid.} | 
{ill.} | 
{ind.} | 
{indoeur.} | 
{inkl.} | 
{jap.} | 
{jur.} | 
{jvf.} | 
{kat.} | 
{kgl.} | 
{kl.} | 
{km/t.} | 
{konj.} | 
{konst.} | 
{kst.} | 
{kurd.} | 
{kvm.} | 
{lab.} | 
{lat.-gr} | 
{log.} | 
{m/sek.} | 
{mek.} | 
{mil.-tekn.} | 
{mill.} | 
{mrd.} | 
{mv.} | 
{mva.} | 
{myt.} | 
{nkr.} | 
{no.-da.} | 
{nom.} | 
{num.} | 
{nåv.} | 
{o.m.} | 
{o.m.a.} | 
{obj.} | 
{obs.} | 
{off.} | 
{op.} | 
{op.% cit.} | 
{op.cit.} | 
{ot.% prp.} | 
{ot.prp.} | 
{p.% a.} | 
{p.% m.} | 
{p.% p.} | 
{p.% p.% m.} | 
{p.% r.} | 
{p.a.} | 
{p.m.} | 
{p.p.} | 
{p.p.m.} | 
{p.r.} | 
{p.t.} | 
{pa.} | 
{pf.} | 
{pkt.} | 
{pl.} | 
{pop.} | 
{pr.} | 
{pr.pr.} | 
{prep.} | 
{pron.} | 
{prp.} | 
{q.s.} | 
{red.} | 
{rek.} | 
{rum.-am.} | 
{sc.} | 
{sd.} | 
{serbokr.} | 
{sign.} | 
{sovj.} | 
{spes.} | 
{sr.} | 
{st.} | 
{st.% meld.} | 
{st.% meld.} | 
{st.% prp.} | 
{st.meld.} | 
{st.meld.} | 
{st.prp.} | 
{subj.} | 
{subst.} | 
{sveits.} | 
{sørafr.} | 
{tel.} | 
{tekn.} | 
{tlf.} | 
{tlf.nr.} | 
{vol.} | 
{vs.} | 
{Johs.} |
{Eftf.} | 
{prof.} | 
{Mr.} | 
{Mrs.} | 
{Ms.} | 
{etc.} | 
{e.g.} | 
{i.e.} |  
{Chr.} | 
{Eks.} | 
{Innst.} | 
{Od.} | 
{Ot.} | 
{Rt.} | 
{St.} | 
{art.} |
{buo.} | 
{cea.} |
{cit.} |
{c1uo.} |
{dea.} | 
{died1.} | 
{dok.} |
{ee.} | 
{gc1.} | 
{ggl.} |
{ibid.} |
{j.d.} | 
{j.e.} | 
{j.s.} | 
{kap.} | 
{l.c.} | 
{l.r.d.} | 
{meld.} | 
{mill.} |
{m.v.} | 
{nr.} |
{op.} | 
{prp.} | 
{rev.} | 
{utg.} |
{v.r.d.} ];


define ABBR [ INTRANSABBR | INTRANSCAPABBR | INTRANSNUMABBR | TRANSABBR ] ;



# =============================================================
echo >>> define tokens
#define Token [ WORD | SYMBOL | TRANSABBR | INIT | NUM ];
define Token [ WORD | SYMBOL | ABBR | INIT | NUM ];
#define Token [ 
#WORD | SYMBOL | TRANSCAPABBR | 
#TRANSNUMABBR | TRANSABBR  | INIT | NUM ];

# =============================================================
echo >>> longest match--insert a newline after each token
define TOK1 [ Token @-> ... NL ] ;
echo >>> map spaces to a newline
define TOK2 [ [WS]+ @-> NL ];
echo >>> copy period of all intransitive abbreviations

define TOKINTRANSCAP [ INTRANSCAPABBR @-> ... NL %. NL || _ WS Capital ] ; 
define TOKINTRANSNUM [ INTRANSNUMABBR @-> ... NL %. NL || _ WS NUM ] ; 
define TOKINTRANS [ INTRANSABBR @-> ... NL %. NL || _ WS CAPNUM ] ; 

# =============================================================
echo >>> compose
read regex [TOKINTRANSCAP .o. TOKINTRANSNUM .o. TOKINTRANS .o. TOK1 .o. TOK2 ];
invert net
