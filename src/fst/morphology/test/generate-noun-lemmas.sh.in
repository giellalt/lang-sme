#!/bin/bash
# Test script for noun lemma generation
#
# change settings here:
POS=nouns
source_file=@abs_srcdir@/../stems/${POS}.lexc
generator_file=@abs_builddir@/../../generator-gt-norm
analyser_file=@abs_builddir@/../../analyser-gt-norm
tags="+N+Sg+Nom"
# advanced settings (leave empty or write full args)
xtags="-t +N+Pl+Nom -t +N+NomAg+Sg+Nom -t +N+NomAg+Pl+Nom -t +N+G3+Sg+Nom -t +N+G7+Sg+Nom"
# {in,ex}clusions are given in arrays to retain spaces, for example:
# inclusions=("--include" "REG EX" "--include" "EGERG XEX")
inclusions=()
exclusions=("--exclude" "(CmpN/Only|ShCmp|\+Cmp/SplitR|\+V\+|AGAdj|AHKASAS|NOT-TO-LEMMATEST|ALLGUOVT|\+Use/MT|RHyph|Cmp/Sh|Rnoun)")

# avoid changing common scripting stuff here:

. "$GIELLA_CORE/scripts/termcolors.bash"
genscript=@GTLEMMATEST@

# ensure this is proper run from make check or otherwise set up
if test -z "$srcdir" ; then
    printf "%sfail%s %s needs to run from make check or set srcdir=.\n" "$red" \
        "$reset" "$0"
    exit 1
fi
if ! test -f "$genscript" ; then
    printf "%sskip%s missing generator script %s\n" "$light_blue" "$reset" \
        "$genscript"
    exit 77
fi
if ! test -f "$generator_file.hfstol" ; then
    printf "%sfail%s missing generator FSA %s.hfstol\n" "$red" "$reset" \
        "$generator_file"
    exit 1
fi
if ! test -f "$analyser_file.hfstol" ; then
    printf "%sfail%s missing analyser FSA %s.hfstol\n" "$red" "$reset" \
        "$analyser_file"
    exit 1
fi

"$genscript" -l "$source_file" \
    -g "$generator_file.hfstol" -a "$analyser_file.hfstol" \
    -t "$tags" $xtags $inclusions $exclusions -T 100 -B 200
rv=$?
if test $rv = 77 ; then
    printf "%sskipped%s\n" "$light_blue" "$reset"
    exit 77
elif test $rv -gt 0 ; then
    printf "%sfailed%s\n" "$red" "$reset"
    exit 1
fi
